---
const pathname = Astro.url.pathname;
import { getCollection } from "astro:content";
import Social from "./Social.astro";
const allPosts = await getCollection("pages");
const allPosts_filtered = allPosts.filter((post: any) => post.data.nav=== true);

const allWorks = await getCollection("works");
const allWorks_filtered = allWorks.filter((work: any) => work.data.visible== true);
const allWorks_ordered = allWorks_filtered.sort((a,b) => a.data.order - b.data.order);

import { Astronav, MenuItems, MenuIcon, Dropdown, DropdownItems, DropdownSubmenu } from "astro-navbar";

const base = import.meta.env.BASE_URL;
// console.log(base===post.data.title);
// console.log(allPosts)
console.log(pathname);
---
<header class="lg:flex-col justify-between p-5 lg:gap-5 mx-auto container">
  <Astronav>
    
    <div class="flex lg:flex-col gap-8 justify-between">
      
      <div class="flex lg:flex-col content-baseline items-center lg:items-start gap-5">
        <!-- title and logo -->
        <div>
          <a href="./" class={pathname === base?"underline text-orange-600":" hover:text-orange-300"}>
          <svg class="h-10 w-10 fill-current"xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140">
            <path d="M-8353.813-4836.607c-1.197-.322-3.68-2.156-5.12-3.782-1.97-2.224-4.446-6.498-5.939-10.25a52.48 52.48 0 0 0-1.174-2.734c-.267-.551-.542-1.357-.611-1.79-.082-.514-.21-.757-.365-.698-.13.05-2.719-.12-5.75-.379-4.748-.405-5.692-.539-6.807-.964-.712-.272-1.728-.563-2.257-.648-1.278-.206-2.855-.823-3.648-1.428l-.643-.49-.796 1.34c-3.988 6.712-10.198 10.93-14.327 9.729-2.684-.78-5.303-4.95-5.31-8.453 0-1.988 1.428-5.616 3.344-8.474.488-.727.887-1.388.887-1.469 0-.08-.404-.863-.897-1.74-1.837-3.267-2.468-6.145-2.318-10.57.171-5.032 1.322-8.612 4.143-12.892 1.19-1.807 4.013-4.833 6.096-6.538 1.62-1.326 5.262-3.837 6.398-4.41.679-.343.817-.508.817-.972 0-.483 1.555-7.023 1.857-7.81.084-.218-.059-.283-.633-.284-1.227 0-5.897-.743-7.807-1.24-6.574-1.71-12.925-6.575-16.133-12.358-1.569-2.829-1.977-4.179-1.97-6.509.01-2.23.545-4.322 1.797-6.992 2.19-4.672 6.129-7.977 10.96-9.193 1.124-.283 2.08-.358 4.329-.341 3.26.025 5.312.363 6.805 1.12.536.27 1.01.493 1.053.493.043 0 .491-.93.996-2.068 1.346-3.032 2.47-5.214 3.243-6.29l.682-.95-.718-.782c-.91-.99-2.366-3.81-2.936-5.689-.837-2.757-.468-6.112 1.014-9.217 1.143-2.395 3.112-3.675 5.654-3.675 1.426 0 2.342.38 3.547 1.467.989.894 2.766 3.525 3.362 4.98.36.876.556 1.138.816 1.089.188-.036.948-.108 1.69-.16 1.246-.089 1.443-.047 2.645.561l1.299.657v-.564c0-.87 1.32-3.183 2.5-4.38 1.183-1.202 2.303-1.816 3.934-2.158 1.03-.216 1.153-.201 1.998.245 1.1.582 1.643 1.564 2.057 3.726.35 1.825.354 2.789.025 4.976l-.253 1.684h.463c.952 0 2.926 1.73 5.158 4.522 2.667 3.336 4.248 7.089 4.92 11.679.335 2.289.283 9.019-.09 11.544-.523 3.555-2.153 9.18-3.58 12.362-.31.69-.483 1.303-.386 1.364.158.098 2.207 6.277 3.54 10.676.272.9.707 2.068.967 2.597.26.53.512 1.1.56 1.269.053.186.568.438 1.308.642 3.204.882 11.033 3.232 11.886 3.568 1.606.633 4.268 2.027 5.685 2.977 1.51 1.013 1.295 1.09 2.395-.85 1.632-2.876 4.41-5.65 7.25-7.238 3.035-1.697 6.47-2.156 8.655-1.156.618.283 1.41.733 1.76 1 1.38 1.053 1.916 3.33 1.325 5.637-.65 2.539-2.765 6.26-4.672 8.223l-.818.841.746.38c1.966 1.003 3.858 4.625 4.727 9.05l.321 1.635 1.281.617c.705.339 1.934.919 2.731 1.288 1.982.917 4.266 2.44 5.474 3.647 3.163 3.162 3.606 6.544 1.445 11.019-1.619 3.351-5.1 5.29-10.87 6.053-3.93.52-9.604-.244-12.132-1.634l-1.213-.666-.797 1.033c-1.094 1.418-2.448 2.414-4.821 3.544-2.62 1.249-5.033 2.044-7.408 2.441-3.54.593-11.077.368-11.975-.356-.37-.298-1.55.41-1.897 1.139-.181.378-.317 1.358-.36 2.597-.149 4.205-.297 5.438-.872 7.236-.314.98-.571 1.89-.572 2.02 0 .48-1.007 2.397-2.076 3.967-1.036 1.523-1.176 1.649-2.516 2.261-1.59.727-1.64.733-3.078.346zm-12-101.985c1.793-.893 3.145-3.388 3.485-6.43.515-4.602-1.178-7.82-4.235-8.046-2.162-.16-4.226 1.247-5.367 3.658-.87 1.84-1.072 3.411-.687 5.361.566 2.876 1.786 4.737 3.661 5.589 1.077.489 1.974.451 3.144-.132z" style="stroke-width:.192424" transform="translate(8422.846 4976.004)"/>
          </svg>
          </a>
        </div>
        <div> 
          <a href="./" class={pathname === base?"underline text-orange-600":" hover:text-orange-300"}>
          Benjamin Chan
        </a>
        </div>
      </div>

      
      <MenuIcon class="w-4 h-4 text-gray-800 lg:hidden" />
    </div>
    <MenuItems class="hidden pt-10 pb-10 lg:pt-0 lg:flex lg:item-center">
      <ul class="flex flex-col gap-5">
        
        {allPosts_filtered.map((post) => (
        <li>
        <a href={(post.id).toLowerCase()} class={pathname === base+(post.id).toLowerCase() ? "underline text-orange-600" : "hover:font-bold hover:text-orange-300 transition-colors"}>
          {post.data.title}
        </a>
        </li>
        ))}
        <Dropdown id="work-dropdown" class="group">
          <button class="flex w-full items-center justify-between">
            <span>Work</span>
            <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="3"
                stroke="currentColor"
                class="w-3 h-3 mt-0.5 group-open/submenu:rotate-180">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M8.25 4.5l7.5 7.5-7.5 7.5"
                  ></path>
            </svg>
          </button>
          <DropdownItems class="relative flex">
            <ul class="top-0 left-1/5 w-40 p-2">
              {
              allWorks_ordered.map((work) => (  
                <li>
                  <a href={'works/'+(work.id).toLowerCase()} class={pathname === base+"works/"+(work.id).toLowerCase() ? "underline text-orange-600" : "hover:font-bold hover:text-orange-300 transition-colors"}>
                    {work.data.title}
                  </a>
                </li>
              ))
              }
            </ul>
          </DropdownItems>
        </DropdownSubmenu>
        <li>
           <Social />
        </li>
        
      </ul>
    </MenuItems>
  </Astronav>
</header>

<script type="module">
// function for forcing open astro nav bar since it doesn't support default open state
(function () {
  function openWorkDropdown() {
    const dd = document.getElementById('work-dropdown');
    if (!dd) return;
    // set attributes/classes the nav script expects
    dd.classList.add('open');
    dd.setAttribute('open', '');
    dd.setAttribute('aria-expanded', 'true');

    // reveal any toggle icons
    dd.querySelectorAll('.dropdown-toggle, .astronav-toggle').forEach(t => {
      t.classList.remove('hidden');
      t.setAttribute('aria-expanded', 'true');
    });

    // show items (covers different possible rendered classnames)
    dd.querySelectorAll('.astronav-dropdown-items, .dropdown-items, .relative.flex').forEach(el => {
      el.style.display = 'block';
    });
  }

  document.addEventListener('DOMContentLoaded', openWorkDropdown);
  document.addEventListener('astro:after-swap', openWorkDropdown);
})();
</script>



<!-- <div class="lg:mb-4">
  <a href="./" class={pathname ==="/"?"underline text-orange-600":" hover:text-orange-300"}>
    <svg class="h-10 w-10 fill-current"xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140">
      <path d="M-8353.813-4836.607c-1.197-.322-3.68-2.156-5.12-3.782-1.97-2.224-4.446-6.498-5.939-10.25a52.48 52.48 0 0 0-1.174-2.734c-.267-.551-.542-1.357-.611-1.79-.082-.514-.21-.757-.365-.698-.13.05-2.719-.12-5.75-.379-4.748-.405-5.692-.539-6.807-.964-.712-.272-1.728-.563-2.257-.648-1.278-.206-2.855-.823-3.648-1.428l-.643-.49-.796 1.34c-3.988 6.712-10.198 10.93-14.327 9.729-2.684-.78-5.303-4.95-5.31-8.453 0-1.988 1.428-5.616 3.344-8.474.488-.727.887-1.388.887-1.469 0-.08-.404-.863-.897-1.74-1.837-3.267-2.468-6.145-2.318-10.57.171-5.032 1.322-8.612 4.143-12.892 1.19-1.807 4.013-4.833 6.096-6.538 1.62-1.326 5.262-3.837 6.398-4.41.679-.343.817-.508.817-.972 0-.483 1.555-7.023 1.857-7.81.084-.218-.059-.283-.633-.284-1.227 0-5.897-.743-7.807-1.24-6.574-1.71-12.925-6.575-16.133-12.358-1.569-2.829-1.977-4.179-1.97-6.509.01-2.23.545-4.322 1.797-6.992 2.19-4.672 6.129-7.977 10.96-9.193 1.124-.283 2.08-.358 4.329-.341 3.26.025 5.312.363 6.805 1.12.536.27 1.01.493 1.053.493.043 0 .491-.93.996-2.068 1.346-3.032 2.47-5.214 3.243-6.29l.682-.95-.718-.782c-.91-.99-2.366-3.81-2.936-5.689-.837-2.757-.468-6.112 1.014-9.217 1.143-2.395 3.112-3.675 5.654-3.675 1.426 0 2.342.38 3.547 1.467.989.894 2.766 3.525 3.362 4.98.36.876.556 1.138.816 1.089.188-.036.948-.108 1.69-.16 1.246-.089 1.443-.047 2.645.561l1.299.657v-.564c0-.87 1.32-3.183 2.5-4.38 1.183-1.202 2.303-1.816 3.934-2.158 1.03-.216 1.153-.201 1.998.245 1.1.582 1.643 1.564 2.057 3.726.35 1.825.354 2.789.025 4.976l-.253 1.684h.463c.952 0 2.926 1.73 5.158 4.522 2.667 3.336 4.248 7.089 4.92 11.679.335 2.289.283 9.019-.09 11.544-.523 3.555-2.153 9.18-3.58 12.362-.31.69-.483 1.303-.386 1.364.158.098 2.207 6.277 3.54 10.676.272.9.707 2.068.967 2.597.26.53.512 1.1.56 1.269.053.186.568.438 1.308.642 3.204.882 11.033 3.232 11.886 3.568 1.606.633 4.268 2.027 5.685 2.977 1.51 1.013 1.295 1.09 2.395-.85 1.632-2.876 4.41-5.65 7.25-7.238 3.035-1.697 6.47-2.156 8.655-1.156.618.283 1.41.733 1.76 1 1.38 1.053 1.916 3.33 1.325 5.637-.65 2.539-2.765 6.26-4.672 8.223l-.818.841.746.38c1.966 1.003 3.858 4.625 4.727 9.05l.321 1.635 1.281.617c.705.339 1.934.919 2.731 1.288 1.982.917 4.266 2.44 5.474 3.647 3.163 3.162 3.606 6.544 1.445 11.019-1.619 3.351-5.1 5.29-10.87 6.053-3.93.52-9.604-.244-12.132-1.634l-1.213-.666-.797 1.033c-1.094 1.418-2.448 2.414-4.821 3.544-2.62 1.249-5.033 2.044-7.408 2.441-3.54.593-11.077.368-11.975-.356-.37-.298-1.55.41-1.897 1.139-.181.378-.317 1.358-.36 2.597-.149 4.205-.297 5.438-.872 7.236-.314.98-.571 1.89-.572 2.02 0 .48-1.007 2.397-2.076 3.967-1.036 1.523-1.176 1.649-2.516 2.261-1.59.727-1.64.733-3.078.346zm-12-101.985c1.793-.893 3.145-3.388 3.485-6.43.515-4.602-1.178-7.82-4.235-8.046-2.162-.16-4.226 1.247-5.367 3.658-.87 1.84-1.072 3.411-.687 5.361.566 2.876 1.786 4.737 3.661 5.589 1.077.489 1.974.451 3.144-.132z" style="stroke-width:.192424" transform="translate(8422.846 4976.004)"/>
    </svg>
  </a>
</div> -->


<div class ="lg:w-1/5 flex flex-row items-center lg:items-baseline lg:flex-col gap-4 text-sm font-normal">

<div class="hidden"> Benjamin Chan</div>
<div class="hidden">
  {allPosts_filtered.map((post) => (
  <a href={(post.id).toLowerCase()} class={pathname === '/' +(post.data.title).toLowerCase() ? "underline text-orange-600" : "hover:font-bold hover:text-orange-300 transition-colors"}>
    {post.data.title}
  </a>
  ))}
  <div>
    <Social />
  </div>
  <div class="fixed bottom-10 mt-4">
    <p class="mt-2 text-xs">Â© 2025 Benjamin Chan</p>
  </div>
</div>

</div>
