[["Map",1,2,9,10,76,77,124,125],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.13.8","content-config-digest","4fd5272450916c73","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://cmhbenjamin.github.io/\",\"compressHTML\":true,\"base\":\"/cmhben.com/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[[null,{\"base\":\"/cmhben.com/\"}]],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,24,25,37,38,49,50,62,63],"exploring-houdini-volumes-tips-and-techniques",{"id":11,"data":13,"body":20,"filePath":21,"digest":22,"deferredRender":23},{"title":14,"pubDate":15,"lastmod":16,"description":17,"tags":18},"Exploring Houdini Volumes: Tips and Techniques",["Date","2025-01-15T18:50:42.419Z"],["Date","2025-01-15T18:50:42.420Z"],"Volume simulation in Houdini",[19],"houdini","# Houdini minimalist\n\n# Pyro\n## Creating source\npolygon to volume with vdb\n- more simple but noise is harder to control compare to particles\npoint to volume\n- better control with attributes on points\n- rasterize after\n### Volumerasteriseattributes\n#### Coverage\nName of the point attribute that stores the coverage (or influence) of each particle. If the coverage attribute does not exist, \neach particle is assumed to have a coverage of 1.\n#### Attribute Rules\nDifferent ways to interpolate particles values into voxel, control per attributes","src/content/blog/exploring-houdini-volumes-tips-and-techniques.mdx","387e7f39ea76b107",true,"ffmpeg-cheatsheet",{"id":24,"data":26,"body":34,"filePath":35,"digest":36,"deferredRender":23},{"title":27,"pubDate":28,"lastmod":29,"description":30,"tags":31},"ffmpeg cheatsheet",["Date","2025-01-08T20:38:15.371Z"],["Date","2025-01-08T20:38:16.024Z"],"Cheat sheet for using ffmpeg to convert files, video to frames, frames to video",[32,33],"ffmpeg","script","```bash\nvideo to gif\nffmpeg  -i invideo.mp4 -vf \"palettegen\" -y out_palette.png\nffmpeg  -i invideo.mp4 -i out_palette.png -lavfi \"paletteuse\" -y out.gif\n\n\npic to h.264 mp4\nffmpeg -r 60 -f image2 -s 1920x1080 -i pic%04d.png -vcodec libx264 -crf 25  -pix_fmt yuv420p test.mp4\n-r is the framerate (fps)\n-crf is the quality, lower means better quality, 15-25 is usually good\n-s is the resolution\n-pix_fmt yuv420p specifies the pixel format, change this as needed\n\nshow list of supported codecs:\nffmpeg -codecs\nffmpeg -formats\n\nmultithreading\nuse all threads\n-threads 0\n\nffmpeg -i jumper_breakdown.mov -r 24 -vcodec libx264 -crf 16 -pix_fmt yuv420p -c:a libfdk_aac -b:a 320k -vbr 3 -threads 0 jumper_breakdown_low.mov\n\n\nffmpeg -f image2 -start_number 1480 -i electric_v1.%d.png -vf \"palettegen\" -y out_platette.png\n\nffmpeg -i byProcessionBreakdown.mov -r 24 -vcodec libx264 -crf 25 -pix_fmt yuv420p -threads 0 byProcessionBreakdown_low.mov\n```","src/content/blog/ffmpeg-cheatsheet.mdx","b11fd8cd5d0e278a","file-processing-with-python",{"id":37,"data":39,"body":46,"filePath":47,"digest":48,"deferredRender":23},{"title":40,"pubDate":41,"lastmod":42,"description":43,"tags":44},"file processing with Python",["Date","2025-01-08T20:40:47.528Z"],["Date","2025-01-08T20:40:47.528Z"],"Code I used in the pass to process files with python",[45],"Python","```python\n\nfrom os import listdir, rename\nfrom os.path import abspath, split, join,splitext\nimport sys\nimport glob\n\ndef main():\n\ttdir = abspath(sys.argv[1])\n\tpaths = listdir(tdir)\n\tfor path in paths:\n\t\tfilepath, ext = splitext(path)\n\t\thead, filename = split(filepath)\n\t\tif (filename[-3:]==\"(1)\"):\n\t\t\tnewpath = join(tdir,filename[:-4]+ext)\n\t\t\tprint join(tdir,path)\n\t\t\tprint newpath\n\t\t\trename(join(tdir,path),newpath)\n\nif __name__ == \"__main__\":\n\tmain()\n```","src/content/blog/file-processing-with-python.mdx","a51d2479ceaf0f42","moviepy",{"id":49,"data":51,"body":59,"filePath":60,"digest":61,"deferredRender":23},{"title":52,"pubDate":53,"lastmod":54,"description":55,"tags":56},"Procedural Reel with Moviepy ",["Date","2025-01-07T02:39:28.272Z"],["Date","2025-01-08T00:16:42.720Z"],"Editing my demo reel with Moviepy python lib",[57,58,49],"python","video","# Automating my demo reel \nI started using nixos on my server, it's a procedural os so every settings of the computer is defined in the configuration file. For my reel, why can't it do the same?\n- https://www.youtube.com/watch?v=BBFub0zErFA\n- https://zulko.github.io/moviepy/getting_started/index.html\n\n## Editing\n\n## Combining\n## Adding text\n## Front and end\n\n## Issue encounter\nCompositing a compositVideoClip on a video cause the edge to be pixalated. It looks like it's an alpha issue. To get around this, I just export the text as individual object,\ninstead of a compositVideoClip. \n[Probably related bug](https://github.com/Zulko/moviepy/issues/1472)\n\n```python\ncombine_clip_text =CompositeVideoClip([title_clip,studio_clip,description_clip],size=(1920*2,1080*2))\ncombine_clip =CompositeVideoClip(video,combine_clip_text)\n```","src/content/blog/moviepy.mdx","751c045d3f8e6070","simple-compositing-with-houdini-copernicus",{"id":62,"data":64,"body":73,"filePath":74,"digest":75,"deferredRender":23},{"title":65,"pubDate":66,"lastmod":67,"description":68,"tags":69},"Simple compositing with Houdini Copernicus",["Date","2025-01-07T05:03:25.899Z"],["Date","2025-01-07T05:03:25.899Z"],"Houdini Copernicus\n",[70,71,72],"Copernicus","Houdini","Compositing","# How to use Copernicus the wrong way\n> **`WIP post`**\n- I was trying to use **Copernicus** as a Nuke replacement, \n- there isn't a redirection of what replace what \n\n\n> TODO:\n> - pictures of node, examples\n## Common nodes nuke equivalent\n| Copernicus |  Nuke|\n|--------|----|\n| File | Read|\n| over | blend|\n| noise | fractalnoise|\n| remap | fit+ramp|\n| bright | grade gain|\n| hsv | satuation, value, hue|\n| transform | transform|\n| channel swap/add/split/extract | shuffle|\n| glow | glow|\n\n### Interesting nodes\n- dilateerode = dilate\n- chromaticaberration\n\n## tutorials\n- https://www.youtube.com/watch?v=ZPL215vfNwg\n- https://thevfxmentor.com/quicktips/COP\n- https://www.sidefx.com/docs/houdini/copernicus/working_with_cops.html","src/content/blog/simple-compositing-with-houdini-copernicus.mdx","986aac43651f810c","pages",["Map",78,79,87,88,95,96,101,102,109,110,116,117],"about",{"id":78,"data":80,"body":84,"filePath":85,"digest":86,"deferredRender":23},{"title":81,"lastmod":82,"nav":83,"showdate":83},"About",["Date","2025-01-02T00:41:23.269Z"],false,"export const startDate = new Date(2018,1);\nexport const years = new Date(Date.now()-startDate).getUTCFullYear()-1970;\n\nI am a Fx artist specialize in Fx simulation and procedural animation.\nI am located in Los Angeles with {years} years of experience working at studios including Disney Animation, ILM, Pixar, Dreamworks TV and The Mill.\nI enjoys creating unique graphics and solving technical challenges with nodes and codes.\n\nWhen I am free I like to take pictures, bouldering and brew coffee.\n\n[About this website](/colophon)","src/content/pages/about.mdx","06d41baf86df6102","colophon",{"id":87,"data":89,"body":92,"filePath":93,"digest":94,"deferredRender":23},{"title":90,"lastmod":91,"nav":83,"showdate":23},"Colophon",["Date","2025-01-16T23:04:22.991Z"],"import { Image, Picture } from 'astro:assets';\n\n# Colophon\nI build this website mostly for recording the more technical aspect of projects that is hard to show in a reel\n\nAlso for storing my notes and process when I work on project\nI want this site to look simple and unique, avoid cookie-cutter UI components\nLeave out planty of breathing room, only show necessary info\n\n## Features\n- Responsive design\n- Edit content using Markdown\n- Manage content with Frontmatter CMS in VSCode\n- Emojis\n  \u003CPicture class=\"emoji\" src=\"/emoji/Froggy.webp\" formats={['webp']} width=\"40\" height=\"40\" alt=\"froggy\" /> \n  \u003CPicture class=\"emoji\" src =\"/emoji/LC_worry_rave.GIF\" formats={['webp']} width=\"40\" height=\"40\" alt=\"froggy\"/>\n  https://discadia.com/emojis/?q=worry\n## Software\n- Astro\n- Tailwindcss \n- VSCode\n- Frontmatter CMS\n\n## Design\n### Look and feel\nMinimalist, only necessary info on the page, breathing room\n### icon\nplastic toy from houdini\ndrew in Procreate on ipad pro\n### Font\n- Roboto\n- Montserrat Variable\n- EB Garamond (not used but looks nice)\n\n\n>## TODO:\n> - reel breakdown, interactive with video player if possible\n> - image management system\n> - post index page, with description and image\n> - related post attribute\n> - Add a wiki site for storing info in case I forget things\n>  1. Fx related\n>      1. Fx reference like videos and images\n>      2. helpful tutorials\n>      3. Houdini nodes and vex usages\n>      4. python in Houdin\n>  2. machine learning\n>  3. website building \n>  4. personal hobbies - books, coffee,\n> Digital garden\n> - [personal wiki] \n>    - [personal knowlegebase](https://tomcritchlow.com/blogchains/digital-gardens/)\n>    - [garden history](https://maggieappleton.com/garden-history)\n  \n## Reference\n- Minimalist design\n  - [Negative space, cool color - mitchellh.com](https://mitchellh.com/)\n  - [Organic, texture, ](https://eva.town/)\n  - [https://angezanetti.com/](https://angezanetti.com/)\n  - [https://shud.in/thoughts/enlightment](https://shud.in/thoughts/enlightment)\n  - [Cool illustrations and effective style](https://sonnet.io/posts/hummingbirds/)\n  - [Simple monofonts](https://www.eddiedale.com/uses)\n  - [Less Minimalist, readble and stylish](https://maggieappleton.com/garden-history)\n- Full page image\n  - https://dgetz.co\n- Artist site\n  - [https://www.altcinc.com/info](https://www.altcinc.com/info)\n- 3d\n  - [https://peteroravec.com/](https://peteroravec.com/)\n- Website gallery\n  - [https://onepagelove.com/](https://onepagelove.com/)\n  - [https://brutalistwebsites.com/](https://brutalistwebsites.com/)\n  - [https://www.awwwards.com/awwwards/collections/minimal/](https://www.awwwards.com/awwwards/collections/minimal/)\n  - [Dead simple sites](https://deadsimplesites.com/)\n- Ultimate Minimalist\n  - [https://www.berkshirehathaway.com/](https://www.berkshirehathaway.com/)\n  - [http://bettermotherfuckingwebsite.com/](http://bettermotherfuckingwebsite.com)","src/content/pages/colophon.mdx","a28137683ef98878","index",{"id":95,"data":97,"filePath":99,"digest":100,"deferredRender":23},{"title":95,"lastmod":98,"nav":83,"showdate":83},["Date","2025-01-03T01:29:06.864Z"],"src/content/pages/index.mdx","e66429343b92c790","now",{"id":101,"data":103,"body":106,"filePath":107,"digest":108,"deferredRender":23},{"title":104,"lastmod":105,"nav":83,"showdate":23},"Now",["Date","2025-07-10T19:17:39.458Z"],"## 2025-07\n\n- I built a new pc. My old pc is almost 10 years old. it was able to keep up most of my games and some 3d project but it starting to show its age.\n- Revisiting this website, aiming to get put this up and running. I finally get some time in-between jobs.\n- Working on personal project with RBD. Haven't got chace to workon Rigid body dynamics in projects yet. I am trying to work on some\n\n### Games\n- Started replaying Death stranding- Director's Cut and Baldur's Gate 3\n\n### Coffee\n- [Single Speed Coffee](https://singlespeedcoffeeroasters.com/)\n    - Ethiopia Yirgacheffe\n    - Floral, black tea, lemon, orange\n\n- [SEY Coffee](https://www.seycoffee.com/)\n    - Sike Bokossa\n    - Ethiopia Landrace -Washed\n    - Watermelon, peach, lemongrass\n\n### Book\n- Four Thousand Weeks: Time Management for Mortals\n\n***\n\n## 2025-01\n\n- Just finished a machine learning course on Coursera.\n\n- I am working on this personal website, learning Astro and tailwingcss.\n\n- Building my reel procedurally with moviepy.\n\n- Compositing with copernicus in Houdini.\n\n\n[about now](https://nownownow.com/about)","src/content/pages/now.mdx","3ea0dc2ef2a4713e","posts",{"id":109,"data":111,"filePath":114,"digest":115,"deferredRender":23},{"title":112,"lastmod":113,"nav":83,"showdate":23},"Posts",["Date","2025-01-07T23:37:32.592Z"],"src/content/pages/posts.mdx","b0fa39ea92d69377","resume",{"id":116,"data":118,"body":121,"filePath":122,"digest":123,"deferredRender":23},{"title":119,"lastmod":120,"nav":23,"showdate":23},"Reel & Resume",["Date","2025-07-10T19:36:18.634Z"],"import {Vimeo} from 'astro-embed';\n\n\u003Cdiv>\u003CVimeo id =\"1071301168\" />\u003C/div>\n\n[Resume](/Benjamin_Chan_Fx_Resume.pdf)","src/content/pages/resume.mdx","53cf57ff7565849a","works",["Map",126,127,140,141,153,154,164,165,177,178,185,186,196,197,207,208,216,217,226,227,240,241,247,248,252,253,262,263,269,270,276,277,281,282],"invasion_s3",{"id":126,"data":128,"body":135,"filePath":136,"assetImports":137,"digest":139,"deferredRender":23},{"title":129,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":133,"image":134},"Invasion S3","star fx",2014,"Disney Animation",4,"__ASTRO_IMAGE_../../assets/work/wish.jpg","procedural lightning, solar flare\nWide shot lightning \nRe-factor forground procedural lightning/signal fx on wall to wide angle, optimizing detail base on distance from camera","src/content/work/Invasion_s3.mdx",[138],"../../assets/work/wish.jpg","81a2192063be7eea","alien",{"id":140,"data":142,"body":148,"filePath":149,"assetImports":150,"digest":152,"deferredRender":23},{"title":143,"description":144,"releaseYear":145,"studio":132,"visible":83,"order":146,"image":147},"Alien Romulus","Zero gravity acid",2024,1,"__ASTRO_IMAGE_../../assets/work/alien.jpg","import { Image, Picture } from 'astro:assets';\nimport cover from \"../../assets/work/alien.jpg\";\n\n\u003CImage src={cover} alt=\"cover\" /> \n\n## Zero gravity spinning acid\nIn the sequence the gravity was disabled so when the alien got shot the acid fly around freely.\nInitially it was flying freely but the art direction later changed it slowly form a spinning tube like tunnel, so the characters can navigate through it in the middle.\nThe Fx lead generated a number of different acid shape and we placed them along the scene.\n\n- placing the acid cache is more efficient for hero pieces since there are too much art direction involed\n- need a way to store the scattered points so when the upperstream setup change we keep the look for the pieces\n- using instanced acide geo helps to keep the look of the acid consistence, but lack interaction\n- using post deform with a velocity field help adding variation to the acid pieces\n\n### Acid shapes look\n[image of acid shapes]\n[ reference from slow motion]\n- Directional, like a hand reaching out\n- Fluid like motion, with surface tension stringy look\n\n### motion\n- slow, looking dangerous, drifting through the space\n\n\n### things I learnt\n- hand placing of hero acid is better than using scatter and randomly placing\n- having a setup to swap out low res version of the acid speed up\n- when using scatter always save the point attributes so you can have a version of the distribution even when  you change the upperstream\n- Building attractive looking for nice looking acid shapes\n- keep the setup simple\n\n\n#### Houdini setup\n##### Source\n1. use mountain and transform then subtract with the orignal position for v\n2. group by cluster and randomize v by cluster, set some of the v to 0 to get the stringy look (I saw other people using fractured pieces to drive the velocity, it makes sense too)\n\n##### Simulation\nmost important part is the scale and surface tension setting. The overall scene scale depends on the smallest detail you want to see . So it often need to be larger than real world scale. \nI use a top wedging setup to find the right look of the liquid\n\n1. Higher substeps\n2. Add id attribute\n###### quick attempt to reducing holes\n3. surface oversampling helps with keeping the elongated shape continue but adding particles in the missing area\n4. particle separation helps with keeping the points in the thin film evenly distributed so there will be less holes poping \n5. reducing the grid scale (increasing resolution) helps so there will be enough resolution for thin area\n\nother resource for surface tension\nhttps://medium.com/@vupham_37726/houdini-flip-surface-tension-demystified-f1239da880ce\n\n\nRecreation at home\n\n### Acid advection\nAcid where retimed and advected by a vdb field to create more directable motion\n\n### Secondary elements\nSome seconary effects includes broken alien pieces, smaller acid droplets for smaller details and cached static smoke and simulated smoke emit when acid touch the wall\n- Alien pieces\n- Acid droplets\n- Acid smokes at melting metal\n\n\n## Sparks\ngunshot sparks matching older movies and reference footage","src/content/work/alien.mdx",[151],"../../assets/work/alien.jpg","3c13f5a0db077dd3","audi",{"id":153,"data":155,"body":159,"filePath":160,"assetImports":161,"digest":163,"deferredRender":23},{"title":156,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":157,"image":158},"Audi e-tron",6,"__ASTRO_IMAGE_../../assets/work/audi.jpg","import { Image, Picture } from 'astro:assets';\nimport audi from \"../../assets/work/audi.jpg\";\n\n\u003CImage src={audi} alt=\"audi\" /> \n\nDevelop simulation and look for ice melting effect on the car surface for \"Audi e-tron\" commercial using multiple layers of procedural material building, mask animation and snow grain generation.\nTo-do: redo in Houdini 22","src/content/work/audi.mdx",[162],"../../assets/work/audi.jpg","65381f6084e2f579","byprocession",{"id":164,"data":166,"body":172,"filePath":173,"assetImports":174,"digest":176,"deferredRender":23},{"title":167,"description":168,"releaseYear":131,"studio":169,"visible":83,"order":170,"image":171},"By Procession","personal piece base on concept art","Personal",9,"__ASTRO_IMAGE_../../assets/work/byprocession.jpg","The demoreel project I did in Gnomon. I was unsure what direction I want to take in my career so I thought I would do a more generalist project.\nDoing fx in Maya was aweful and I just had my first class in Houdini  \n\nLightning\nRigging\nmodelling texturing\ncompositing tricks\ncamera effects","src/content/work/byprocession.mdx",[175],"../../assets/work/byprocession.jpg","8269a2fc6e658b37","capstone",{"id":177,"data":179,"body":181,"filePath":182,"assetImports":183,"digest":184,"deferredRender":23},{"title":180,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":133,"image":134},"Wish","- Star breaking out of staff\n  - procedural animation \n  - Work with Visual efect designer for \n  - light ray radiating, merge in the second shot before star come out\n  - todo: talk about other shots as well\n  - math for rotating the ray\n  - variation on speed, line, color\n  - nuke compositing\n  - ray matching the shape of the staff crystal\n  - erode at the end\n\n\n  chicken dance","src/content/work/capstone.mdx",[138],"7ea62f50c2415962","dungeon_n_dragon",{"id":185,"data":187,"body":191,"filePath":192,"assetImports":193,"digest":195,"deferredRender":23},{"title":180,"description":130,"releaseYear":131,"studio":188,"visible":83,"order":189,"image":190},"ILM",7,"__ASTRO_IMAGE_../../assets/work/dnd.jpg","Smoke and portal\nrbd falling stuff\nlocal gravity","src/content/work/dungeon_n_dragon.mdx",[194],"../../assets/work/dnd.jpg","b98ab475113f25e5","elemental",{"id":196,"data":198,"body":202,"filePath":203,"assetImports":204,"digest":206,"deferredRender":23},{"title":199,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":200,"image":201},"Elemental",5,"__ASTRO_IMAGE_../../assets/work/elemental.jpg","2. Elemental \n  - Wade breaking out of pipe\n  - 2 shots, one for trailer\n  - pipe water\n    - need to avoid the hand, head\n    - 3 water, slowly merge into 1\n    - water slower over time\n    - water splash as wade get out of the pipe, hide the initial shape deformed of wade when he is in the pipe\n    - cover camera when it reaches the water\n\n  - underwater\n    - bubbles\n    - inside and out side water are rendered separatly\n    - avoide covering ember's face\n    - swirling motion - use another volume solver for the velocity field (air field), enhanced velocity conservation\n\nHoudini examples: water pipe with guide\nbubbles\nhot source","src/content/work/elemental.mdx",[205],"../../assets/work/elemental.jpg","ce278d3bbd9258bc","equalizer",{"id":207,"data":209,"body":211,"filePath":212,"assetImports":213,"digest":215,"deferredRender":23},{"title":180,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":170,"image":210},"__ASTRO_IMAGE_../../assets/work/obiwan.jpg","partition of smoke\nfalling leaves\nprocedural smoke","src/content/work/equalizer.mdx",[214],"../../assets/work/obiwan.jpg","0c947bffd86fab24","jurrassic",{"id":216,"data":218,"body":221,"filePath":222,"assetImports":223,"digest":225,"deferredRender":23},{"title":180,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":219,"image":220},8,"__ASTRO_IMAGE_../../assets/work/jurassic.jpg","waterfall\nexplosion\n\nHoudini example: waterfall and bubbles\nline between above and below water","src/content/work/jurrassic.mdx",[224],"../../assets/work/jurassic.jpg","8d320167469ee0ac","mandalorian",{"id":226,"data":228,"body":235,"filePath":236,"assetImports":237,"digest":239,"deferredRender":23},{"title":229,"description":230,"releaseYear":231,"studio":232,"visible":83,"order":233,"image":234},"The Mandalorian Season 3","The Mandalorian Season 3 water fx",2013,"Industrial Light and magic",3,"__ASTRO_IMAGE_../../assets/work/mando3.jpg","- 1st episode of the Mandalorian\n  - crocodile + turtle attact people\n  - Custom solver for water \"nexus\" in Houdini\n  - Mostly running existing setup, but need to customize certain area, such as the legs moving so fast\n  - Simulation for all water elements\n\n  - beach water line\n  - steps splashing (left leg)\n  - monster pushing water to the shore\n  - right leg pushing water quick\n  - whitewater, spray, ...\n  - The challenge was some fast moving motion and the waterline need to be at a certain level.\n\n\n  - Houdini scene monster on beach setup","src/content/work/mandalorian.mdx",[238],"../../assets/work/mando3.jpg","1c06aaf013f6831b","obiwan",{"id":240,"data":242,"body":243,"filePath":244,"assetImports":245,"digest":246,"deferredRender":23},{"title":180,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":170,"image":210},"pre-cached smoke fx\nground smoke\ninteraction\natmos","src/content/work/obiwan.mdx",[214],"8bce559ae5064184","ornamic",{"id":247,"data":249,"body":181,"filePath":250,"assetImports":251,"digest":184,"deferredRender":23},{"title":180,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":133,"image":134},"src/content/work/ornamic.mdx",[138],"restless",{"id":252,"data":254,"body":258,"filePath":259,"assetImports":260,"digest":261,"deferredRender":23},{"title":255,"description":130,"releaseYear":256,"studio":257,"visible":83,"order":133,"image":134},"Restless",2026,"Personal project","line animation","src/content/work/restless.mdx",[138],"26b1b718c4af1af2","superman",{"id":262,"data":264,"body":265,"filePath":266,"assetImports":267,"digest":268,"deferredRender":23},{"title":180,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":133,"image":134},"cliff falling debris\nheightmap as collision\ncollider conservation\nrhythm of rocks falling","src/content/work/superman.mdx",[138],"5ad2d990ca078d22","water_drops_on_windows",{"id":269,"data":271,"body":272,"filePath":273,"assetImports":274,"digest":275,"deferredRender":23},{"title":180,"description":130,"releaseYear":131,"studio":169,"visible":83,"order":170,"image":171},"The demoreel project I did in Gnomon. I was unsure what direction I want to take in my career so I thought I would do a more generalist project.\nDoing fx in Maya was aweful and I just had my first class in Houdini  \n\nLightning\nRigging\nmodelling texturing","src/content/work/water_drops_on_windows.mdx",[175],"88842a1363e9dc3d","wish",{"id":276,"data":278,"body":181,"filePath":279,"assetImports":280,"digest":184,"deferredRender":23},{"title":180,"description":130,"releaseYear":131,"studio":132,"visible":83,"order":133,"image":134},"src/content/work/wish.mdx",[138],"moana",{"id":281,"data":283,"body":288,"filePath":289,"assetImports":290,"digest":292,"rendered":293},{"title":284,"description":285,"releaseYear":131,"studio":132,"visible":23,"order":286,"image":287},"Moana 2","Bioluminacent Magic for Ancestor transformation",2,"__ASTRO_IMAGE_../../assets/work/moana2.jpg","# Bioluminescent Magic for Ancestor Transformation\n\u003Cdiv class=\"flex items-center justify-center\">\n    \u003Cdiv>\n        \u003Ciframe  width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/on-K551_8ac?si=eAMrmodfzgZewpX2\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen>\n        \u003C/iframe>\n        \u003Ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/TZa7V_qyAVA?si=wcuJidfw4aTQbABf\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen>\u003C/iframe>\n    \u003C/div>\n\u003C/div>\n\n\u003C!-- Local videos commented out for now:\n\u003Cvideo src=\"https://youtu.be/on-K551_8ac\" controls autoplay muted playsinline loop>\u003C/video>\n\u003Cvideo src=\"/moana2/tuna_transform.webm\" controls autoplay muted playsinline loop>\u003C/video>\n-->\n\n## The task\n\nIn the film, when people pass away they transform into sea animals. In this sequence, Moana's ancestors gather around Maui's underwater air bubble and chant to bring Moana back to life. The ancestor's animal form is a whale shark, which is much larger than the human form. So we needed a way to cover that change smoothly.\n\n## Light\n\n![Looking up from below](https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/US_Navy_110607-N-XD935-191_Navy_Diver_2nd_Class_Ryan_Arnold%2C_assigned_to_Mobile_Diving_and_Salvage_Unit_2%2C_snorkels_on_the_surface_to_monitor_multi.jpg/1920px-US_Navy_110607-N-XD935-191_Navy_Diver_2nd_Class_Ryan_Arnold%2C_assigned_to_Mobile_Diving_and_Salvage_Unit_2%2C_snorkels_on_the_surface_to_monitor_multi.jpg)\n\nThe idea starts from the whale's glow that slowly becomes shadow. At the same time a soft spherical glow grows from the center. Circular light expands into a human silhouette while a human shadow gradually appears.\n\n### Caustics\n\n![Caustic](/moana2/demoreel_screenshot_caustic.png)\n\n\u003Cvideo src=\"/cmhben.com/moana2/caustic.v0001.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\nThe initial idea came from an [Entagma tutorial](https://www.youtube.com/watch?v=GPYlgxMaMQs). I adapted it to use a sphere as the light source and project points onto a curved surface so that the shapes get larger towards the edge and have a natural fading out without a mask.\n\n\u003Cvideo src=\"moana2/caustic.v0002.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\n### Overall caustic setup\n\u003Cimg class=\"max-h-150\" src=\"moana2/caustics_sop.v0001.png\"/>\n\n1. set orign_N set the base direction from sphere to the project plane\n2. deform the sphere for the normal\n3. refract on the deformed sphere and project onto projection plane\n    ```c\n        vector ray_dir;\n        vector p2, uvw;\n        int prim;\n        // orig_N is the direction pointing from the sphere to the \n        // projection plane, N is the normal of the deforming sphere\n        ray_dir = refract(v@orig_N, v@N, ch(\"ior\"));\n        ray_dir *= 100;\n        // check intersection and project onto collider\n        v@ray_dir = ray_dir;\n        prim = intersect(1, v@P, ray_dir, p2, uvw);\n        if (prim == -1) {\n            removepoint(0, @ptnum);\n            v@Cd = 0;\n        } else {\n            v@Cd = primuv(1, \"Cd\", prim, uvw);\n            v@target_N = primuv(1, \"N\", prim, uvw);\n        }\n        v@P = p2;\n    ```\n4. Set density to filter out sparse area\n    ```c\n        float maxdist = ch(\"maxdist\");\n        int pts[] = nearpoints(0,v@P,maxdist);\n        float density = fit(len(pts),ch(\"min\"),ch(\"max\"),0,1);\n        @Cd = density;\n        @density = density;\n    ```\n5. Use blur sop to shapen and convert to volume\n\n### Whale mask (fading)\n\n\u003Cimg src=\"moana2/demoreel_screenshot_whalemask.png\" alt=\"Whale mask\"/>\n\nA simple mask generated from the whale shark silhouette, with a glow at the edge and animation driven by the glow source distance.\n\n### Ancestor emerging shadow\n\n\u003Cimg src=\"moana2/demoreel_screenshot_shadow.png\" alt=\"Ancestor emerging shadow\"/>\n\nThe whale is much bigger than the human, so to make the transformation feel smooth we have a shadow \"walk out\" as the whale turns into light and the human form emerges. After blurring and layering, the mask approximates the light shape you see when looking up from underwater (Snell's window).\n\n\u003Cvideo src=\"moana2/refraction.v0001.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\nVEX for refraction/projection (similar to caustics):\n\n```c\n// get ray direction towards object\nvector dir = getbbox_center(1) - v@P;\ndir = v@rest_N;\nvector ray_dir = refract(dir, v@N, ch(\"ior\"));\n\n// emit ray from deforming surface and check collision\nvector p2, uvw;\nint prim;\nray_dir *= -100;\nprim = intersect(1, v@P, ray_dir, p2, uvw);\nv@ray_dir = ray_dir;\nif (prim == -1) {\n    v@Cd = 0;\n} else {\n    v@Cd = 1;\n    v@target_N = primuv(1, \"N\", prim, uvw);\n}\n```\n\n\u003Cvideo src=\"moana2/refraction.v0002.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\n\n## Water surface contact\nInteraction with the water surface\nThen we tried a couple different ideas\nThe first logical attept was to have a ripple:\n### Ripple solver\n\nThere are many ways to create ripples in Houdini. The ripple solver is a straightforward choice: source the ripple from the distance between surfaces and apply a ramp to the height offset. It works well but lacks a \"magical\" quality and the shapes are not very clean.\n\n### Procedural circle ripples\n\n![Raindrop](https://images.pexels.com/photos/4396992/pexels-photo-4396992.jpeg)\n\nRain-drop-like circles are gentler. The circle solver gives outward velocity that trails the circle line, whereas the ripple solver primarily moves geometry up and down. It's render in RGB from @N for distortion in compositing\n\n#### Circle Ripple Setup \n\u003Cvideo src=\"moana2/circlesolver.v0001.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\u003Cimg class=\"max-h-150\" src=\"moana2/circle_sop.v0001.png\"/>\n\n1. Animated circle by setting point attributes like trigger frame and life and calculate the pscale foreach point\n    ```c\n    //set age and scale\n    @age = @Frame- @trigger_frame;\n    @pscale = fit(@age,0,@life,v@pscale_range[0],v@pscale_range[1]);\n    v@center =v@P;\n    ```\n2. delete the whole circle before born, add variation to the points circles desolves gradually\n    ```c\n    //delete_after_death\n    float limit = fit(@age,@life*(.7+@death_offset),@life,0,1);\n    if(rand(@id)\u003Climit)\n        removepoint(0,@ptnum);\n    ```\n#### Displace Surface Setup\n\u003Cvideo src=\"moana2/circlesolver.v0002.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\u003Cimg class=\"max-h-150\" src=\"moana2/circle_sop.v0002.png\"/>\n\n1. Offset on in camera z and project onto surface\n    ```c\n    matrix Op_Matrix= optransform(chsop(\"cam\")); \n    vector dir  = getbbox_center(0)-Op_Matrix*set(0,0,0);\n    v@dir = dir;\n    v@P += normalize(dir)*ch(\"mult\");\n    ```\n2. Copy attributes to surface and create mask base on distance from the circle lines\n    ```c\n    int prim;\n    vector primuv;\n    float dist = xyzdist(1,v@P,prim,primuv);\n    vector p = primuv(1,\"P\",prim,primuv);\n    @age = primuv(1,\"age\",prim,primuv);\n    @life = primuv(1,\"life\",prim,primuv);\n    @dist = length(p-v@P);\n    @mask = chramp(\"ramp\",fit(@dist,0,ch(\"maxdist\"),0,1));\n    ```\n3. Calculate height multiplyer with height, then apply displacement onto surface\n    ```c\n    v@rest_N = v@N;\n    float age_height =chramp(\"ramp\", fit(@age,0,@life,0,1));\n    v@P+= v@N*@mask*ch(\"mult\")*age_height;\n    ```\n## Bioluminescent particles\n\nReferencing the original movie where the grandmother ray swims by. As an FX artist my instinct was to create a big splash but the sequence needed a more somber, magical feeling.\n\n![Whale bubble feeding](https://upload.wikimedia.org/wikipedia/commons/3/3a/Humpback_whale_bubble_net_feeding_Christin_Khan_NOAA.jpg)\n\n### Whitewater shape solver\n\n\u003Cvideo src=\"moana2/biolumin.v0001.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\nI used a existing studio solver for enhancing foam shape. It uses PCA to add forces so particles form stringy, foam-like patterns. Here is the overall process:\n1. Find all the particles in a patch around each point\n2. Center the patch.\n3. Create the covariance matrix.\n4. Calculate eigenvectors and eigenvalues.\n\nThe eigenvector basically represent the overall direction of the patch, using the perpendicular of the principal eigenvector as force aligns the particles along the eiganvector so there are more string like feature.\n\n\u003Cvideo src=\"moana2/chainsolver.v0002.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\n#### SOP PCA\n\nHoudini has a SOP PCA implementation. It requires points to be arranged so each point stores neighbor positions. It's impractical for this use case here but helps illustrate the concept.\n\n![pca](/moana2/pca.v0001.png)\nSet neighbours wrangle:\n```c\n// for each point, store the neighbors and their position into arrays\n// search radius and max neighbours\nfloat proxrad = ch(\"proxrad\");\nint maxneigh = chi(\"maxneigh\");\nint pts[] = pcfind(0, \"P\", @P, proxrad, maxneigh);\nvector p_data[];\nfor (int i = 0; i \u003C maxneigh; i++) {\n    if (i \u003C len(pts)) {\n        p_data[i] = point(0, \"P\", pts[i]);\n    } else {\n        p_data[i] = v@P;\n    }\n}\ni[]@__neighbors__ = pts;\nv[]@p_data = p_data;\n```\nDuplicate neighbors wrangle:\n```c\n// the number of dimensions (number of neighbors)\n// this links to the current iteration of the for loop\nint iter = chi(\"iter\");\nvector new_p = v[]@p_data[iter-1];\nnew_p -= v@P;\naddpoint(0, new_p);\nremovepoint(0, @ptnum);\n\n```\n\nReferences:\n- Entagma tutorial: https://www.youtube.com/watch?v=GPYlgxMaMQs\n- SideFX PCA dejitter example: https://www.sidefx.com/contentlibrary/pca","src/content/work/moana.md",[291],"../../assets/work/moana2.jpg","209fc73085da992d",{"html":294,"metadata":295},"\u003Ch1 id=\"bioluminescent-magic-for-ancestor-transformation\">Bioluminescent Magic for Ancestor Transformation\u003C/h1>\n\u003Cdiv class=\"flex items-center justify-center\">\n    \u003Cdiv>\n        \u003Ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/on-K551_8ac?si=eAMrmodfzgZewpX2\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen>\n        \u003C/iframe>\n        \u003Ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/TZa7V_qyAVA?si=wcuJidfw4aTQbABf\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen>\u003C/iframe>\n    \u003C/div>\n\u003C/div>\n\u003C!-- Local videos commented out for now:\n\u003Cvideo src=\"https://youtu.be/on-K551_8ac\" controls autoplay muted playsinline loop>\u003C/video>\n\u003Cvideo src=\"/moana2/tuna_transform.webm\" controls autoplay muted playsinline loop>\u003C/video>\n-->\n\u003Ch2 id=\"the-task\">The task\u003C/h2>\n\u003Cp>In the film, when people pass away they transform into sea animals. In this sequence, Moana’s ancestors gather around Maui’s underwater air bubble and chant to bring Moana back to life. The ancestor’s animal form is a whale shark, which is much larger than the human form. So we needed a way to cover that change smoothly.\u003C/p>\n\u003Ch2 id=\"light\">Light\u003C/h2>\n\u003Cp>\u003Cimg src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/US_Navy_110607-N-XD935-191_Navy_Diver_2nd_Class_Ryan_Arnold%2C_assigned_to_Mobile_Diving_and_Salvage_Unit_2%2C_snorkels_on_the_surface_to_monitor_multi.jpg/1920px-US_Navy_110607-N-XD935-191_Navy_Diver_2nd_Class_Ryan_Arnold%2C_assigned_to_Mobile_Diving_and_Salvage_Unit_2%2C_snorkels_on_the_surface_to_monitor_multi.jpg\" alt=\"Looking up from below\">\u003C/p>\n\u003Cp>The idea starts from the whale’s glow that slowly becomes shadow. At the same time a soft spherical glow grows from the center. Circular light expands into a human silhouette while a human shadow gradually appears.\u003C/p>\n\u003Ch3 id=\"caustics\">Caustics\u003C/h3>\n\u003Cp>\u003Cimg src=\"/cmhben.com/moana2/demoreel_screenshot_caustic.png\" alt=\"Caustic\">\u003C/p>\n\u003Cp>\u003Cvideo src=\"/cmhben.com/moana2/caustic.v0001.webm\" controls autoplay muted playsinline loop>\u003C/video>\u003C/p>\n\u003Cp>The initial idea came from an \u003Ca href=\"https://www.youtube.com/watch?v=GPYlgxMaMQs\">Entagma tutorial\u003C/a>. I adapted it to use a sphere as the light source and project points onto a curved surface so that the shapes get larger towards the edge and have a natural fading out without a mask.\u003C/p>\n\u003Cp>\u003Cvideo src=\"moana2/caustic.v0002.webm\" controls autoplay muted playsinline loop>\u003C/video>\u003C/p>\n\u003Ch3 id=\"overall-caustic-setup\">Overall caustic setup\u003C/h3>\n\u003Cimg class=\"max-h-150\" src=\"moana2/caustics_sop.v0001.png\">\n\u003Col>\n\u003Cli>set orign_N set the base direction from sphere to the project plane\u003C/li>\n\u003Cli>deform the sphere for the normal\u003C/li>\n\u003Cli>refract on the deformed sphere and project onto projection plane\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    vector ray_dir;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    vector p2, uvw;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> prim;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // orig_N is the direction pointing from the sphere to the \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // projection plane, N is the normal of the deforming sphere\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    ray_dir \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> refract\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(v@orig_N, v@N, \u003C/span>\u003Cspan style=\"color:#B392F0\">ch\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"ior\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    ray_dir \u003C/span>\u003Cspan style=\"color:#F97583\">*=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 100\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // check intersection and project onto collider\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    v@ray_dir \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> ray_dir;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    prim \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> intersect\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, v@P, ray_dir, p2, uvw);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (prim \u003C/span>\u003Cspan style=\"color:#F97583\">==\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">        removepoint\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, @ptnum);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        v@Cd \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    } \u003C/span>\u003Cspan style=\"color:#F97583\">else\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        v@Cd \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> primuv\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Cd\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, prim, uvw);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        v@target_N \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> primuv\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"N\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, prim, uvw);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    v@P \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> p2;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003Cli>Set density to filter out sparse area\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    float\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> maxdist \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> ch\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"maxdist\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> pts\u003C/span>\u003Cspan style=\"color:#F97583\">[]\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#B392F0\"> nearpoints\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,v@P,maxdist);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    float\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> density \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> fit\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">len\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(pts),\u003C/span>\u003Cspan style=\"color:#B392F0\">ch\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"min\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">),\u003C/span>\u003Cspan style=\"color:#B392F0\">ch\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"max\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">),\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    @Cd \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> density;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    @density \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> density;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003Cli>Use blur sop to shapen and convert to volume\u003C/li>\n\u003C/ol>\n\u003Ch3 id=\"whale-mask-fading\">Whale mask (fading)\u003C/h3>\n\u003Cimg src=\"moana2/demoreel_screenshot_whalemask.png\" alt=\"Whale mask\">\n\u003Cp>A simple mask generated from the whale shark silhouette, with a glow at the edge and animation driven by the glow source distance.\u003C/p>\n\u003Ch3 id=\"ancestor-emerging-shadow\">Ancestor emerging shadow\u003C/h3>\n\u003Cimg src=\"moana2/demoreel_screenshot_shadow.png\" alt=\"Ancestor emerging shadow\">\n\u003Cp>The whale is much bigger than the human, so to make the transformation feel smooth we have a shadow “walk out” as the whale turns into light and the human form emerges. After blurring and layering, the mask approximates the light shape you see when looking up from underwater (Snell’s window).\u003C/p>\n\u003Cp>\u003Cvideo src=\"moana2/refraction.v0001.webm\" controls autoplay muted playsinline loop>\u003C/video>\u003C/p>\n\u003Cp>VEX for refraction/projection (similar to caustics):\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// get ray direction towards object\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">vector dir \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> getbbox_center\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> v@P;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">dir \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> v@rest_N;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">vector ray_dir \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> refract\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(dir, v@N, \u003C/span>\u003Cspan style=\"color:#B392F0\">ch\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"ior\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// emit ray from deforming surface and check collision\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">vector p2, uvw;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> prim;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">ray_dir \u003C/span>\u003Cspan style=\"color:#F97583\">*=\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#79B8FF\">100\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">prim \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> intersect\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, v@P, ray_dir, p2, uvw);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">v@ray_dir \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> ray_dir;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (prim \u003C/span>\u003Cspan style=\"color:#F97583\">==\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    v@Cd \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} \u003C/span>\u003Cspan style=\"color:#F97583\">else\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    v@Cd \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    v@target_N \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> primuv\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"N\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, prim, uvw);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cvideo src=\"moana2/refraction.v0002.webm\" controls autoplay muted playsinline loop>\u003C/video>\u003C/p>\n\u003Ch2 id=\"water-surface-contact\">Water surface contact\u003C/h2>\n\u003Cp>Interaction with the water surface\nThen we tried a couple different ideas\nThe first logical attept was to have a ripple:\u003C/p>\n\u003Ch3 id=\"ripple-solver\">Ripple solver\u003C/h3>\n\u003Cp>There are many ways to create ripples in Houdini. The ripple solver is a straightforward choice: source the ripple from the distance between surfaces and apply a ramp to the height offset. It works well but lacks a “magical” quality and the shapes are not very clean.\u003C/p>\n\u003Ch3 id=\"procedural-circle-ripples\">Procedural circle ripples\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://images.pexels.com/photos/4396992/pexels-photo-4396992.jpeg\" alt=\"Raindrop\">\u003C/p>\n\u003Cp>Rain-drop-like circles are gentler. The circle solver gives outward velocity that trails the circle line, whereas the ripple solver primarily moves geometry up and down. It’s render in RGB from @N for distortion in compositing\u003C/p>\n\u003Ch4 id=\"circle-ripple-setup\">Circle Ripple Setup\u003C/h4>\n\u003Cp>\u003Cvideo src=\"moana2/circlesolver.v0001.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\u003Cimg class=\"max-h-150\" src=\"moana2/circle_sop.v0001.png\">\u003C/p>\n\u003Col>\n\u003Cli>Animated circle by setting point attributes like trigger frame and life and calculate the pscale foreach point\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">//set age and scale\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">@age \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> @Frame\u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> @trigger_frame;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">@pscale \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> fit\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(@age,\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,@life,v@\u003C/span>\u003Cspan style=\"color:#FFAB70\">pscale_range\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">],v@\u003C/span>\u003Cspan style=\"color:#FFAB70\">pscale_range\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">v@center \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\">v@P;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003Cli>delete the whole circle before born, add variation to the points circles desolves gradually\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">//delete_after_death\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">float\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> limit \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> fit\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(@age,@life\u003C/span>\u003Cspan style=\"color:#F97583\">*\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">.7\u003C/span>\u003Cspan style=\"color:#F97583\">+\u003C/span>\u003Cspan style=\"color:#E1E4E8\">@death_offset),@life,\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">rand\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(@id)\u003C/span>\u003Cspan style=\"color:#F97583\">&#x3C;\u003C/span>\u003Cspan style=\"color:#E1E4E8\">limit)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">    removepoint\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,@ptnum);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003C/ol>\n\u003Ch4 id=\"displace-surface-setup\">Displace Surface Setup\u003C/h4>\n\u003Cp>\u003Cvideo src=\"moana2/circlesolver.v0002.webm\" controls autoplay muted playsinline loop>\u003C/video>\n\u003Cimg class=\"max-h-150\" src=\"moana2/circle_sop.v0002.png\">\u003C/p>\n\u003Col>\n\u003Cli>Offset on in camera z and project onto surface\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">matrix Op_Matrix\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> optransform\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">chsop\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"cam\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)); \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">vector dir  \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> getbbox_center\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Op_Matrix\u003C/span>\u003Cspan style=\"color:#F97583\">*\u003C/span>\u003Cspan style=\"color:#B392F0\">set\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">v@dir \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> dir;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">v@P \u003C/span>\u003Cspan style=\"color:#F97583\">+=\u003C/span>\u003Cspan style=\"color:#B392F0\"> normalize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(dir)\u003C/span>\u003Cspan style=\"color:#F97583\">*\u003C/span>\u003Cspan style=\"color:#B392F0\">ch\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"mult\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003Cli>Copy attributes to surface and create mask base on distance from the circle lines\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> prim;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">vector primuv;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">float\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> dist \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> xyzdist\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,v@P,prim,primuv);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">vector p \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> primuv\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"P\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,prim,primuv);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">@age \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> primuv\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"age\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,prim,primuv);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">@life \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> primuv\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"life\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,prim,primuv);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">@dist \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> length\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(p\u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\">v@P);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">@mask \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> chramp\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"ramp\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#B392F0\">fit\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(@dist,\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#B392F0\">ch\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"maxdist\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">),\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">));\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003Cli>Calculate height multiplyer with height, then apply displacement onto surface\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">v@rest_N \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> v@N;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">float\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> age_height \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\">chramp\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"ramp\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#B392F0\">fit\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(@age,\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,@life,\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">v@P\u003C/span>\u003Cspan style=\"color:#F97583\">+=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> v@N\u003C/span>\u003Cspan style=\"color:#F97583\">*\u003C/span>\u003Cspan style=\"color:#E1E4E8\">@mask\u003C/span>\u003Cspan style=\"color:#F97583\">*\u003C/span>\u003Cspan style=\"color:#B392F0\">ch\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"mult\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003Cspan style=\"color:#F97583\">*\u003C/span>\u003Cspan style=\"color:#E1E4E8\">age_height;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"bioluminescent-particles\">Bioluminescent particles\u003C/h2>\n\u003Cp>Referencing the original movie where the grandmother ray swims by. As an FX artist my instinct was to create a big splash but the sequence needed a more somber, magical feeling.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://upload.wikimedia.org/wikipedia/commons/3/3a/Humpback_whale_bubble_net_feeding_Christin_Khan_NOAA.jpg\" alt=\"Whale bubble feeding\">\u003C/p>\n\u003Ch3 id=\"whitewater-shape-solver\">Whitewater shape solver\u003C/h3>\n\u003Cp>\u003Cvideo src=\"moana2/biolumin.v0001.webm\" controls autoplay muted playsinline loop>\u003C/video>\u003C/p>\n\u003Cp>I used a existing studio solver for enhancing foam shape. It uses PCA to add forces so particles form stringy, foam-like patterns. Here is the overall process:\u003C/p>\n\u003Col>\n\u003Cli>Find all the particles in a patch around each point\u003C/li>\n\u003Cli>Center the patch.\u003C/li>\n\u003Cli>Create the covariance matrix.\u003C/li>\n\u003Cli>Calculate eigenvectors and eigenvalues.\u003C/li>\n\u003C/ol>\n\u003Cp>The eigenvector basically represent the overall direction of the patch, using the perpendicular of the principal eigenvector as force aligns the particles along the eiganvector so there are more string like feature.\u003C/p>\n\u003Cp>\u003Cvideo src=\"moana2/chainsolver.v0002.webm\" controls autoplay muted playsinline loop>\u003C/video>\u003C/p>\n\u003Ch4 id=\"sop-pca\">SOP PCA\u003C/h4>\n\u003Cp>Houdini has a SOP PCA implementation. It requires points to be arranged so each point stores neighbor positions. It’s impractical for this use case here but helps illustrate the concept.\u003C/p>\n\u003Cp>\u003Cimg src=\"/cmhben.com/moana2/pca.v0001.png\" alt=\"pca\">\nSet neighbours wrangle:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// for each point, store the neighbors and their position into arrays\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// search radius and max neighbours\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">float\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> proxrad \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> ch\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"proxrad\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> maxneigh \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> chi\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"maxneigh\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> pts\u003C/span>\u003Cspan style=\"color:#F97583\">[]\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#B392F0\"> pcfind\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"P\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, @P, proxrad, maxneigh);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">vector p_data\u003C/span>\u003Cspan style=\"color:#F97583\">[]\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">for\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#F97583\">int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> i \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; i \u003C/span>\u003Cspan style=\"color:#F97583\">&#x3C;\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> maxneigh; i\u003C/span>\u003Cspan style=\"color:#F97583\">++\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (i \u003C/span>\u003Cspan style=\"color:#F97583\">&#x3C;\u003C/span>\u003Cspan style=\"color:#B392F0\"> len\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(pts)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">        p_data\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[i] \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> point\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"P\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#FFAB70\">pts\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[i]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    } \u003C/span>\u003Cspan style=\"color:#F97583\">else\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">        p_data\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[i] \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> v@P;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">i\u003C/span>\u003Cspan style=\"color:#F97583\">[]\u003C/span>\u003Cspan style=\"color:#E1E4E8\">@__neighbors__ \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> pts;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">v\u003C/span>\u003Cspan style=\"color:#F97583\">[]\u003C/span>\u003Cspan style=\"color:#E1E4E8\">@p_data \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> p_data;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Duplicate neighbors wrangle:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// the number of dimensions (number of neighbors)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// this links to the current iteration of the for loop\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> iter \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> chi\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"iter\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">vector new_p \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> v\u003C/span>\u003Cspan style=\"color:#F97583\">[]\u003C/span>\u003Cspan style=\"color:#E1E4E8\">@\u003C/span>\u003Cspan style=\"color:#FFAB70\">p_data\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[iter\u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">new_p \u003C/span>\u003Cspan style=\"color:#F97583\">-=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> v@P;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">addpoint\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, new_p);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">removepoint\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, @ptnum);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>References:\u003C/p>\n\u003Cul>\n\u003Cli>Entagma tutorial: \u003Ca href=\"https://www.youtube.com/watch?v=GPYlgxMaMQs\">https://www.youtube.com/watch?v=GPYlgxMaMQs\u003C/a>\u003C/li>\n\u003Cli>SideFX PCA dejitter example: \u003Ca href=\"https://www.sidefx.com/contentlibrary/pca\">https://www.sidefx.com/contentlibrary/pca\u003C/a>\u003C/li>\n\u003C/ul>",{"headings":296,"localImagePaths":342,"remoteImagePaths":343,"frontmatter":344,"imagePaths":346},[297,300,303,306,309,312,315,318,321,324,327,330,333,336,339],{"depth":146,"slug":298,"text":299},"bioluminescent-magic-for-ancestor-transformation","Bioluminescent Magic for Ancestor Transformation",{"depth":286,"slug":301,"text":302},"the-task","The task",{"depth":286,"slug":304,"text":305},"light","Light",{"depth":233,"slug":307,"text":308},"caustics","Caustics",{"depth":233,"slug":310,"text":311},"overall-caustic-setup","Overall caustic setup",{"depth":233,"slug":313,"text":314},"whale-mask-fading","Whale mask (fading)",{"depth":233,"slug":316,"text":317},"ancestor-emerging-shadow","Ancestor emerging shadow",{"depth":286,"slug":319,"text":320},"water-surface-contact","Water surface contact",{"depth":233,"slug":322,"text":323},"ripple-solver","Ripple solver",{"depth":233,"slug":325,"text":326},"procedural-circle-ripples","Procedural circle ripples",{"depth":133,"slug":328,"text":329},"circle-ripple-setup","Circle Ripple Setup",{"depth":133,"slug":331,"text":332},"displace-surface-setup","Displace Surface Setup",{"depth":286,"slug":334,"text":335},"bioluminescent-particles","Bioluminescent particles",{"depth":233,"slug":337,"text":338},"whitewater-shape-solver","Whitewater shape solver",{"depth":133,"slug":340,"text":341},"sop-pca","SOP PCA",[],[],{"title":284,"fmContentType":345,"studio":132,"releaseYear":131,"visible":23,"image":291,"description":285,"order":286},"page",[]]